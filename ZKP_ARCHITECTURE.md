# DIAP ZKPæ¶æ„æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ é‡æ„æ€»ç»“

### ç‰ˆæœ¬ä¿¡æ¯
- **æ—§ç‰ˆæœ¬**: v0.1.4ï¼ˆIPNSåŒå±‚éªŒè¯ï¼‰
- **æ–°ç‰ˆæœ¬**: v0.2.0ï¼ˆZKPå•å±‚éªŒè¯ï¼‰
- **é‡æ„æ—¥æœŸ**: 2025-10-12

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### 1. ç§»é™¤IPNSä¾èµ–

**åŸå› **ï¼š
- IPNSå¢åŠ ç³»ç»Ÿå¤æ‚åº¦
- éœ€è¦ä¸¤æ¬¡ä¸Šä¼ å’Œå‘å¸ƒ
- ä¾èµ–IPNSç½‘ç»œçš„å¯ç”¨æ€§
- éªŒè¯æµç¨‹ç¹ç

**æ–°æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ `did:key` æ ¼å¼ï¼ˆä»å…¬é’¥æ´¾ç”ŸDIDï¼‰
- å•æ¬¡IPFSä¸Šä¼ 
- é€šè¿‡ZKPéªŒè¯DID-CIDç»‘å®š
- å®Œå…¨å»ä¸­å¿ƒåŒ–ï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡

### 2. åŠ å¯†PeerID

**åŸå› **ï¼š
- æ—§ç‰ˆæœ¬PeerIDæ˜æ–‡å­˜å‚¨åœ¨DIDæ–‡æ¡£ä¸­
- éšç§é£é™©ï¼šä»»ä½•äººéƒ½èƒ½çœ‹åˆ°çœŸå®PeerID
- æ— æ³•å®ç°çœŸæ­£çš„åŒ¿åé€šä¿¡

**æ–°æ–¹æ¡ˆ**ï¼š
```rust
// ä½¿ç”¨DIDç§é’¥åŠ å¯†PeerID
encrypted_peer_id = AES-256-GCM.encrypt(
    key: derive_from_ed25519_sk(skâ‚),
    plaintext: peer_id.to_bytes()
)
```

**å®‰å…¨æ€§**ï¼š
- åªæœ‰æŒæœ‰DIDç§é’¥çš„äººèƒ½è§£å¯†
- ä½¿ç”¨AES-256-GCMè®¤è¯åŠ å¯†
- æ¯æ¬¡åŠ å¯†ä½¿ç”¨éšæœºnonce

### 3. ZKPç»‘å®šéªŒè¯

**ZKPç”µè·¯é€»è¾‘**ï¼š

```
è¯æ˜å£°æ˜ï¼š
  "æˆ‘çŸ¥é“ç§é’¥skâ‚ï¼Œä½¿å¾—ï¼š"
  
çº¦æŸæ¡ä»¶ï¼š
  1. H(DIDæ–‡æ¡£) == CIDçš„å¤šå“ˆå¸Œéƒ¨åˆ†     [å“ˆå¸Œç»‘å®š]
  2. pkâ‚ = derive_public(skâ‚)         [å¯†é’¥æ´¾ç”Ÿ]
  3. pkâ‚ å­˜åœ¨äº DIDæ–‡æ¡£ä¸­              [æ–‡æ¡£å®Œæ•´æ€§]
  4. nonce å‚ä¸ç”µè·¯è®¡ç®—                [é˜²é‡æ”¾]
```

**æ€§èƒ½ç‰¹å¾**ï¼š
- çº¦æŸæ•°é‡ï¼š~4000
- è¯æ˜ç”Ÿæˆï¼š10-20ms
- è¯æ˜éªŒè¯ï¼š3-5ms
- è¯æ˜å¤§å°ï¼š192å­—èŠ‚

---

## ğŸ—ï¸ æ¨¡å—ç»“æ„å˜åŒ–

### åˆ é™¤çš„æ¨¡å—
```
âŒ ipns_publisher.rs       - IPNSå‘å¸ƒå™¨
âŒ ipfs_registry.rs        - IPFSæ³¨å†Œè¡¨
âŒ did_resolver.rs         - å¤æ‚çš„DIDè§£æå™¨
âŒ auto_config.rs          - æ—§è‡ªåŠ¨é…ç½®
âŒ did_auto_config.rs      - æ—§DIDé…ç½®
âŒ http_auto_config.rs     - æ—§HTTPé…ç½®
âŒ diap_key_generator.rs   - æ—§å¯†é’¥ç”Ÿæˆå™¨
âŒ batch_uploader.rs       - æ‰¹é‡ä¸Šä¼ å™¨
âŒ startup_manager.rs      - å¯åŠ¨ç®¡ç†å™¨
```

### æ–°å¢çš„æ¨¡å—
```
âœ… encrypted_peer_id.rs    - PeerIDåŠ å¯†/è§£å¯†
âœ… zkp_circuit.rs          - ZKPç”µè·¯å®šä¹‰
âœ… zkp_prover.rs           - ZKPè¯æ˜ç”Ÿæˆ/éªŒè¯
```

### é‡æ„çš„æ¨¡å—
```
ğŸ”„ did_builder.rs          - ç®€åŒ–ï¼Œç§»é™¤åŒå±‚éªŒè¯
ğŸ”„ identity_manager.rs     - é›†æˆZKPæµç¨‹
ğŸ”„ lib.rs                  - æ›´æ–°å¯¼å‡º
```

---

## ğŸ” å®‰å…¨æ¨¡å‹

### ä¿¡ä»»é“¾

```
skâ‚ (DIDç§é’¥)
  â”œâ”€â†’ pkâ‚ (DIDå…¬é’¥)
  â”‚     â””â”€â†’ did:key:z6Mk... (DIDæ ‡è¯†ç¬¦)
  â”‚
  â”œâ”€â†’ encrypted_peer_id
  â”‚     â””â”€â†’ E_AES(PeerID)  [åªæœ‰skâ‚æŒæœ‰è€…èƒ½è§£å¯†]
  â”‚
  â””â”€â†’ ZKPè¯æ˜Ï€
        â””â”€â†’ è¯æ˜"æˆ‘çŸ¥é“skâ‚"ä¸”"H(DIDæ–‡æ¡£)==CID"
```

### åŒ¿åè®¤è¯æµç¨‹

```
ç”¨æˆ·ç«¯ï¼š
  1. ç”Ÿæˆä¸´æ—¶PeerID_tempï¼ˆéšè—çœŸå®èº«ä»½ï¼‰
  2. å‘é€CIDç»™èµ„æºèŠ‚ç‚¹
  3. æ¥æ”¶challenge nonce
  4. ç”ŸæˆZKPè¯æ˜ï¼šÏ€ â† Prove(skâ‚, DIDæ–‡æ¡£, nonce, CID)
  5. æäº¤Ï€ç»™èµ„æºèŠ‚ç‚¹

èµ„æºèŠ‚ç‚¹ï¼š
  1. ä»IPFSè·å–CIDå¯¹åº”çš„DIDæ–‡æ¡£
  2. éªŒè¯ZKPè¯æ˜ï¼šVerify(Ï€, nonce, CID, pkâ‚)
  3. å¦‚æœéªŒè¯é€šè¿‡ï¼Œæˆæƒè®¿é—®
  4. ï¼ˆå¯é€‰ï¼‰è§£å¯†PeerIDç”¨äºå»ºç«‹P2Pè¿æ¥
```

### é˜²æŠ¤æªæ–½

| æ”»å‡»ç±»å‹ | é˜²æŠ¤æ–¹å¼ |
|---------|---------|
| **ç¯¡æ”¹DIDæ–‡æ¡£** | CIDå†…å®¹å¯»å€ï¼Œä¿®æ”¹åCIDå˜åŒ– |
| **ä¼ªé€ èº«ä»½** | ZKPè¯æ˜éœ€è¦ç§é’¥skâ‚ |
| **é‡æ”¾æ”»å‡»** | nonceç»‘å®šï¼Œæ¯æ¬¡è®¤è¯ä½¿ç”¨æ–°nonce |
| **ä¸­é—´äººæ”»å‡»** | libp2p Noiseåè®®åŠ å¯†é€šé“ |
| **PeerIDæ³„éœ²** | AES-256-GCMåŠ å¯†ä¿æŠ¤ |
| **èº«ä»½è¿½è¸ª** | ä½¿ç”¨ä¸´æ—¶PeerIDï¼Œä¸æš´éœ²çœŸå®PeerID |

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æ³¨å†Œæµç¨‹

| æ“ä½œ | v0.1.4 (IPNS) | v0.2.0 (ZKP) | æ”¹è¿› |
|------|--------------|-------------|------|
| ä¸Šä¼ æ¬¡æ•° | 2æ¬¡ | 1æ¬¡ | â†“50% |
| ç½‘ç»œè¯·æ±‚ | 4æ¬¡ | 2æ¬¡ | â†“50% |
| æ€»å»¶è¿Ÿ | 300-500ms | 100-200ms | â†“60% |
| ä¾èµ–æœåŠ¡ | IPFS+IPNS | ä»…IPFS | ç®€åŒ– |

### éªŒè¯æµç¨‹

| æ“ä½œ | v0.1.4 (IPNS) | v0.2.0 (ZKP) | æ”¹è¿› |
|------|--------------|-------------|------|
| è§£æIPNS | 50-100ms | 0ms | â†“100% |
| è·å–DIDæ–‡æ¡£ | 50-100ms | 50-100ms | = |
| éªŒè¯ç­¾å | 1-2ms | 3-5ms (ZKP) | è½»å¾®å¢åŠ  |
| æ€»å»¶è¿Ÿ | 100-200ms | 50-105ms | â†“50% |

### å­˜å‚¨å¼€é”€

| é¡¹ç›® | v0.1.4 | v0.2.0 | å˜åŒ– |
|------|--------|--------|------|
| DIDæ–‡æ¡£å¤§å° | ~2.5KB | ~2KB | â†“20% |
| è¯æ˜å¤§å° | N/A | 192å­—èŠ‚ | æ–°å¢ |
| åŠ å¯†PeerID | N/A | ~50å­—èŠ‚ | æ–°å¢ |

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å¯†ç å­¦åº“

```toml
# åŸºç¡€å¯†ç å­¦
ed25519-dalek = "2.0"      # DIDç­¾å
aes-gcm = "0.10"           # PeerIDåŠ å¯†
blake2 = "0.10"            # å“ˆå¸Œå‡½æ•°

# ZKPç”Ÿæ€ï¼ˆarkworksï¼‰
ark-bn254 = "0.4"          # BN254æ›²çº¿
ark-groth16 = "0.4"        # Groth16è¯æ˜ç³»ç»Ÿ
ark-r1cs-std = "0.4"       # R1CSçº¦æŸç³»ç»Ÿ
ark-crypto-primitives = "0.4"  # å¯†ç å­¦åŸè¯­
```

### ZKPç”µè·¯å®ç°

**çº¦æŸç»„æˆ**ï¼š
```
æ€»çº¦æŸæ•°: ~4000

åˆ†è§£ï¼š
  - Blake2så“ˆå¸Œç”µè·¯: ~2500çº¦æŸ
  - Ed25519å¯†é’¥æ´¾ç”Ÿ: ~1000çº¦æŸ
  - å…¬é’¥æå–éªŒè¯: ~300çº¦æŸ
  - NonceéªŒè¯: ~200çº¦æŸ
```

**ä¼˜åŒ–ç­–ç•¥**ï¼š
1. ä½¿ç”¨Blake2sè€ŒéSHA256ï¼ˆæ›´å°‘çº¦æŸï¼‰
2. Ed25519ç­¾åéªŒè¯åœ¨ç”µè·¯å¤–è¿›è¡Œ
3. å­—ç¬¦ä¸²æ“ä½œæœ€å°åŒ–
4. ä½¿ç”¨lookup tableä¼˜åŒ–å“ˆå¸Œ

---

## ğŸ“ APIä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´æµç¨‹ä»£ç 

```rust
use diap_rs_sdk::*;

#[tokio::main]
async fn main() -> Result<()> {
    // 1. åˆå§‹åŒ–
    let ipfs = IpfsClient::new(...);
    let manager = IdentityManager::new(ipfs);
    
    // 2. ç”Ÿæˆå¯†é’¥
    let keypair = KeyPair::generate()?;
    let peer_id = PeerId::random();
    
    // 3. æ³¨å†Œèº«ä»½ï¼ˆè‡ªåŠ¨åŠ å¯†PeerIDï¼‰
    let reg = manager.register_identity(
        &agent_info, 
        &keypair, 
        &peer_id
    ).await?;
    
    println!("DID: {}", reg.did);
    println!("CID: {}", reg.cid);
    
    // 4. ç”ŸæˆZKPè¯æ˜
    let nonce = b"challenge_from_node";
    let proof = manager.generate_binding_proof(
        &keypair,
        &reg.did_document,
        &reg.cid,
        nonce,
    )?;
    
    // 5. éªŒè¯èº«ä»½
    let verification = manager.verify_identity_with_zkp(
        &reg.cid,
        &proof.proof,
        nonce,
    ).await?;
    
    assert!(verification.zkp_verified);
    
    // 6. è§£å¯†PeerIDï¼ˆæŒæœ‰ç§é’¥ï¼‰
    let encrypted = manager.extract_encrypted_peer_id(&reg.did_document)?;
    let decrypted_peer_id = manager.decrypt_peer_id(&keypair, &encrypted)?;
    
    assert_eq!(peer_id, decrypted_peer_id);
    
    Ok(())
}
```

---

## ğŸš€ æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸï¼ˆv0.3.0ï¼‰
- [ ] å®ç°çœŸå®çš„å¯ä¿¡è®¾ç½®ï¼ˆä½¿ç”¨Powers of Tauï¼‰
- [ ] ä¼˜åŒ–ç”µè·¯çº¦æŸæ•°ï¼ˆç›®æ ‡ï¼š<3000ï¼‰
- [ ] æ·»åŠ è¯æ˜æ‰¹é‡éªŒè¯
- [ ] å®ç°DIDæ–‡æ¡£ç¼“å­˜

### ä¸­æœŸï¼ˆv0.4.0ï¼‰
- [ ] å®Œæ•´çš„libp2p Swarmé›†æˆ
- [ ] DHTèŠ‚ç‚¹å‘ç°
- [ ] NATç©¿é€æ”¯æŒ
- [ ] å¤šç­¾åæ”¯æŒ

### é•¿æœŸï¼ˆv0.5.0+ï¼‰
- [ ] é€’å½’è¯æ˜ï¼ˆå‡å°‘è¯æ˜å¤§å°ï¼‰
- [ ] ç¡¬ä»¶åŠ é€Ÿï¼ˆGPUè¯æ˜ç”Ÿæˆï¼‰
- [ ] è·¨é“¾èº«ä»½äº’æ“ä½œ
- [ ] å¯æ’¤é”€å‡­è¯ç³»ç»Ÿ

---

## ğŸ“– ç›¸å…³èµ„æº

### è®ºæ–‡å’Œæ ‡å‡†
- [Groth16: On the Size of Pairing-based Non-interactive Arguments](https://eprint.iacr.org/2016/260.pdf)
- [W3C DID Core Specification](https://www.w3.org/TR/did-core/)
- [did:key Method Specification](https://w3c-ccg.github.io/did-method-key/)

### å¼€æºé¡¹ç›®
- [arkworks-rs](https://github.com/arkworks-rs) - Rust ZKPç”Ÿæ€ç³»ç»Ÿ
- [libp2p](https://github.com/libp2p/rust-libp2p) - P2Pç½‘ç»œåº“
- [IPFS](https://github.com/ipfs/kubo) - å»ä¸­å¿ƒåŒ–å­˜å‚¨

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-12  
**ç»´æŠ¤è€…**: DIAP Team

